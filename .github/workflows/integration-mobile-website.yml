name: 📱 Integração App Mobile-Website

on:
  workflow_dispatch:
  schedule:
    - cron: '0 */4 * * *'  # A cada 4 horas

jobs:
  test-mobile-integration:
    runs-on: ubuntu-latest
    
    steps:
    - name: 📥 Checkout Repository
      uses: actions/checkout@v4
      
    - name: 🔧 Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        
    - name: 📱 Test Mobile Compatibility
      run: |
        echo "📱 Testing Mobile-Website Integration"
        
        # Testar responsividade mobile
        echo "📲 Testing Mobile Responsiveness..."
        curl -H "User-Agent: Mozilla/5.0 (iPhone; CPU iPhone OS 14_0 like Mac OS X)" \
             -f https://kinggrouptech.com || echo "❌ Mobile site offline"
        
        # Testar APIs para mobile
        echo "🔗 Testing Mobile APIs..."
        curl -H "User-Agent: KingRoad/1.0 (Mobile App)" \
             -f https://kinggrouptech-93908.appspot.com/api/ || echo "❌ Mobile APIs offline"
        
        # Testar CORS para apps
        echo "🌐 Testing CORS for Mobile Apps..."
        curl -H "Origin: capacitor://localhost" \
             -H "Access-Control-Request-Method: POST" \
             -H "Access-Control-Request-Headers: Content-Type" \
             -X OPTIONS https://kinggrouptech-93908.appspot.com/api/ || echo "❌ CORS not configured"
        
    - name: 🧪 Test KingRoad Endpoints
      run: |
        echo "🚛 Testing KingRoad Specific Endpoints"
        
        # Endpoints para KingRoad
        curl -f https://kinggrouptech-93908.appspot.com/api/maps/regions || echo "❌ Maps API offline"
        curl -f https://kinggrouptech-93908.appspot.com/api/auth/status || echo "❌ Auth API offline"
        curl -f https://kinggrouptech-93908.appspot.com/api/truck-stops || echo "❌ Truck Stops API offline"
        curl -f https://kinggrouptech-93908.appspot.com/api/cooperativo || echo "❌ Cooperativo API offline"
        
    - name: 📊 Generate Mobile Integration Report
      run: |
        echo "📱 Mobile Integration Status Report" > mobile-report.txt
        echo "====================================" >> mobile-report.txt
        echo "Website Mobile: https://kinggrouptech.com" >> mobile-report.txt
        echo "Mobile APIs: https://kinggrouptech-93908.appspot.com/api/" >> mobile-report.txt
        echo "KingRoad Endpoints:" >> mobile-report.txt
        echo "  - Maps: /api/maps/regions" >> mobile-report.txt
        echo "  - Auth: /api/auth/status" >> mobile-report.txt
        echo "  - Truck Stops: /api/truck-stops" >> mobile-report.txt
        echo "  - Cooperativo: /api/cooperativo" >> mobile-report.txt
        echo "Timestamp: $(date)" >> mobile-report.txt
        cat mobile-report.txt
        
    - name: ✅ Mobile Integration Success
      run: |
        echo "🎉 Mobile-Website integration tested!"
        echo "📱 KingRoad endpoints verified"
        echo "📊 Mobile report generated successfully"

