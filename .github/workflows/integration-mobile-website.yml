name: ðŸ“± IntegraÃ§Ã£o App Mobile-Website

on:
  workflow_dispatch:
  schedule:
    - cron: '0 */4 * * *'  # A cada 4 horas

jobs:
  test-mobile-integration:
    runs-on: ubuntu-latest
    
    steps:
    - name: ðŸ“¥ Checkout Repository
      uses: actions/checkout@v4
      
    - name: ðŸ”§ Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        
    - name: ðŸ“± Test Mobile Compatibility
      run: |
        echo "ðŸ“± Testing Mobile-Website Integration"
        
        # Testar responsividade mobile
        echo "ðŸ“² Testing Mobile Responsiveness..."
        curl -H "User-Agent: Mozilla/5.0 (iPhone; CPU iPhone OS 14_0 like Mac OS X)" \
             -f https://kinggrouptech.com || echo "âŒ Mobile site offline"
        
        # Testar APIs para mobile
        echo "ðŸ”— Testing Mobile APIs..."
        curl -H "User-Agent: KingRoad/1.0 (Mobile App)" \
             -f https://kinggrouptech-93908.appspot.com/api/ || echo "âŒ Mobile APIs offline"
        
        # Testar CORS para apps
        echo "ðŸŒ Testing CORS for Mobile Apps..."
        curl -H "Origin: capacitor://localhost" \
             -H "Access-Control-Request-Method: POST" \
             -H "Access-Control-Request-Headers: Content-Type" \
             -X OPTIONS https://kinggrouptech-93908.appspot.com/api/ || echo "âŒ CORS not configured"
        
    - name: ðŸ§ª Test KingRoad Endpoints
      run: |
        echo "ðŸš› Testing KingRoad Specific Endpoints"
        
        # Endpoints para KingRoad
        curl -f https://kinggrouptech-93908.appspot.com/api/maps/regions || echo "âŒ Maps API offline"
        curl -f https://kinggrouptech-93908.appspot.com/api/auth/status || echo "âŒ Auth API offline"
        curl -f https://kinggrouptech-93908.appspot.com/api/truck-stops || echo "âŒ Truck Stops API offline"
        curl -f https://kinggrouptech-93908.appspot.com/api/cooperativo || echo "âŒ Cooperativo API offline"
        
    - name: ðŸ“Š Generate Mobile Integration Report
      run: |
        echo "ðŸ“± Mobile Integration Status Report" > mobile-report.txt
        echo "====================================" >> mobile-report.txt
        echo "Website Mobile: https://kinggrouptech.com" >> mobile-report.txt
        echo "Mobile APIs: https://kinggrouptech-93908.appspot.com/api/" >> mobile-report.txt
        echo "KingRoad Endpoints:" >> mobile-report.txt
        echo "  - Maps: /api/maps/regions" >> mobile-report.txt
        echo "  - Auth: /api/auth/status" >> mobile-report.txt
        echo "  - Truck Stops: /api/truck-stops" >> mobile-report.txt
        echo "  - Cooperativo: /api/cooperativo" >> mobile-report.txt
        echo "Timestamp: $(date)" >> mobile-report.txt
        cat mobile-report.txt
        
    - name: âœ… Mobile Integration Success
      run: |
        echo "ðŸŽ‰ Mobile-Website integration tested!"
        echo "ðŸ“± KingRoad endpoints verified"
        echo "ðŸ“Š Mobile report generated successfully"

